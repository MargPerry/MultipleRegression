---
title: "Draft Project"
author: ""
date: "11/7/2017"
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(readr)
library(mosaic)
library(ggplot2)
require(magrittr)
require(tidyverse)
require(leaps)
require(Stat2Data)
require(leaps)
library(leaps)
library(car)
require(car)
collegedata <- read_csv("data.csv")
collegeChardata <- read_csv("data2.csv")
```

```{r}
newData = inner_join(collegeChardata, collegedata, by="name")
str(newData)

```



#Stepwise Regression

```{r}
#just to remove missing values of variables 
newData = newData%>%
  filter(!is.na(tier),!is.na(hbcu),!is.na(black_share_fall_2000),!is.na(alien_share_fall_2000),!is.na(pct_stem_2000),
         !is.na(par_median),!is.na(endowment_pc_2000),!is.na(count),!is.na(kq5_cond_parq1))

nullmodel <- lm(kq5_cond_parq1~1, data = newData)
fullmodel <- lm(kq5_cond_parq1~tier + hbcu + black_share_fall_2000 + alien_share_fall_2000 + pct_stem_2000 + par_median + endowment_pc_2000 + count, data = newData)

# With 'scale=fullMSE', the AIC term can be interpreted as Cp
fullMSE <- (summary(fullmodel)$sigma)^2

step(nullmodel, scope = list(upper = fullmodel),
scale = fullMSE, direction = "both")
```

```{r}
summary(lm(kq5_cond_parq1~tier + black_share_fall_2000 + alien_share_fall_2000 + pct_stem_2000 + par_median + endowment_pc_2000, data = newData))
```



```{r}
allsubsets<-regsubsets(kq5_cond_parq1~ count + endowment_pc_2000+par_median+pct_stem_2000+alien_share_fall_2000+ black_share_fall_2000 +hbcu+ tier, data= newData)
plot(allsubsets, scale= "adjr2")
```

```{r}
m1<-plot(kq5_cond_parq1~endowment_pc_2000+par_median+pct_stem_2000+alien_share_fall_2000+ black_share_fall_2000+ tier, data= newData)
Lm1<-lm(kq5_cond_parq1~endowment_pc_2000+par_median+pct_stem_2000+alien_share_fall_2000+ black_share_fall_2000+ tier, data= newData)
summary(Lm1)
m1
```



# Transforming the response

```{r}
c <- ggplot(newData, aes(kq5_cond_parq1))
c+geom_histogram()

newData = newData %>%
  mutate(sqrtkq5_cond_parq1 = sqrt(kq5_cond_parq1))
d <- ggplot(newData, aes(sqrtkq5_cond_parq1))
d+geom_histogram()

newData = newData %>%
  mutate(logendowment_pc_2000 = log(endowment_pc_2000))
e <- ggplot(newData, aes(logendowment_pc_2000))
e+geom_histogram()

newData = newData %>%
  mutate(sqrtalien_share_fall_2000 = sqrt(alien_share_fall_2000))
g <- ggplot(newData, aes(sqrtalien_share_fall_2000))
g+geom_histogram()

# should we convert tier to categorical variable?


```


```{r}
nullmodel <- lm(sqrtkq5_cond_parq1~1, data = newData)
fullmodel <- lm(sqrtkq5_cond_parq1~ tier + hbcu + black_share_fall_2000 + alien_share_fall_2000 + pct_stem_2000 + par_median + endowment_pc_2000 + count, data = newData)

# With 'scale=fullMSE', the AIC term can be interpreted as Cp
fullMSE <- (summary(fullmodel)$sigma)^2

step(nullmodel, scope = list(upper = fullmodel),
scale = fullMSE, direction = "both")
```


```{r}
summary(lm(sqrtkq5_cond_parq1~tier + black_share_fall_2000 + alien_share_fall_2000 + pct_stem_2000 + par_median + endowment_pc_2000, data = newData))
```


```{r}
allsubsets<-regsubsets(sqrtkq5_cond_parq1~ count + logendowment_pc_2000+par_median+pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000 +hbcu+ tier, data=newData)
plot(allsubsets, scale= "adjr2")

```

## none of the variables are collinear
```{r}
vif(Lm1)
```

# Added an interaction term between par_median and tier

```{r}
m1<-plot(sqrtkq5_cond_parq1~logendowment_pc_2000+par_median+pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000+ tier +par_median*tier, data= newData)
Lm1<-lm(sqrtkq5_cond_parq1~logendowment_pc_2000+par_median+pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000+ tier +par_median*tier, data= newData)
summary(Lm1)

```


## All possible combinations
```{r}
reg <- lm(sqrtkq5_cond_parq1 ~ (logendowment_pc_2000 + par_median + pct_stem_2000+sqrtalien_share_fall_2000+black_share_fall_2000+tier)^4, data=newData)
summary(reg)
```


#Nested F- tests
```{r}
Lm1<-lm(sqrtkq5_cond_parq1~logendowment_pc_2000+par_median+pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000+ tier +par_median*tier, data= newData)

nested1 <- lm(sqrtkq5_cond_parq1~par_median+pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000+ tier +par_median*tier, data= newData)
anova(nested1, Lm1)
```
P-value > 0.05 therefore we can use the nested model instead of the full model 

```{r}
m<-lm(sqrtkq5_cond_parq1~endowment_pc_2000+par_median+pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000+ tier +par_median*tier, data= newData)

nested1b <- lm(sqrtkq5_cond_parq1~par_median+pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000+ tier +par_median*tier, data= newData)
anova(nested1b, m)
```

#nested2  
```{r}
Lm<-lm(sqrtkq5_cond_parq1~logendowment_pc_2000 + par_median+pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000+ tier +par_median*tier, data= newData)

nested2 <- lm(sqrtkq5_cond_parq1~logendowment_pc_2000 + pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000 + tier, data= newData)
anova(nested2, Lm)
```
... still need par_median

```{r}
Lm<-lm(sqrtkq5_cond_parq1~ logendowment_pc_2000 + par_median+pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000+ tier +par_median*tier, data= newData)

nested2b <- lm(sqrtkq5_cond_parq1~ logendowment_pc_2000 + pct_stem_2000+sqrtalien_share_fall_2000+ black_share_fall_2000 + par_median, data= newData)
anova(nested2b, Lm)
```
Still need full model 



#Working with model without endowment --nested1
```{r}
plot(residuals(nested1)~fitted(nested1))
abline(0,0)
plot(nested1)
```



2. Assumptions for inference
3. Choosing predictors
4. Testing 
5. Residuals
6. Interpretation  


```{r}
plot(residuals(Lm1))
abline(0,0)
plot(Lm1)
```
6. Interpretation 


